name: Manually triggered workflow
on:
  workflow_dispatch:
    inputs:
      name:
        description: 'Person to greet'
        required: true
        default: 'Mona the Octocat'
      home:
        description: 'location'
        required: false
      message:
        description: 'the commit message'
        required: true
        default: 'The default message'
jobs:
  say_hello:
    runs-on: ubuntu-latest
    steps:
    - uses: dtothefp/actions-ci-env@master
    - run: |
        echo "Hello ${{ github.event.inputs.name }}!"
        echo "- in ${{ github.event.inputs.home }}!"
        echo "The Branch $BRANCH_NAME"
  merge_devel_to_master:
    name: Merge Devel to Master
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Merge branch -> master
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${GITHUB_TOKEN}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/dtothefp/github-packages-publish/merges \
            -d '{"base": "master", "head": "devel", "commit_message": "'"$COMMIT_MESSAGE"'"}'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          COMMIT_MESSAGE: ${{ github.event.inputs.message }}
      - name: Trigger Deploy
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${GITHUB_TOKEN}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/dtothefp/github-packages-publish/actions/workflows/publish.yml/dispatches \
            -d '{"ref": "master"}'
